<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blockly Gaming JS</title>
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background-color: #121212;
      color: #eee;
      font-family: 'Orbitron', sans-serif;
      overflow: hidden;
    }

    #blocklyDiv {
      height: 70%;
      width: 100%;
    }

    #buttons {
      padding: 10px;
      background: linear-gradient(90deg, #1f1f1f, #2b2b2b);
      border-top: 2px solid #444;
    }

    #buttons button {
      background: #111;
      color: #0ff;
      border: 1px solid #0ff;
      padding: 8px 14px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 10px;
      transition: all 0.2s ease;
    }

    #buttons button:hover {
      background: #0ff;
      color: #111;
    }

    #codeArea {
      height: 20%;
      width: 100%;
      background-color: #1a1a1a;
      color: #0f0;
      font-family: monospace;
      padding: 10px;
      overflow: auto;
      border-top: 2px solid #444;
    }

    /* ゲーミング風ブロックスタイルのカスタムテーマ */
    .blocklySvg {
      background: #121212 !important;
    }

    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap');
  </style>
</head>
<body>

<div id="blocklyDiv"></div>
<div id="buttons">
  <button onclick="runCode()">Run</button>
  <button onclick="showCode()">Show JS</button>
</div>
<pre id="codeArea">// JavaScript code appears here</pre>

<!-- Toolbox: 同じままですが視覚に影響しない -->
<xml id="toolbox" style="display: none">
  <category name="Logic (論理)" colour="#00ffff">
    <block type="controls_if"></block>
    <block type="logic_compare"></block>
  </category>
  <category name="Loops (くりかえし)" colour="#ff00ff">
    <block type="controls_repeat_ext">
      <value name="TIMES"><shadow type="math_number"><field name="NUM">5</field></shadow></value>
    </block>
    <block type="controls_whileUntil"></block>
  </category>
  <category name="Math (数学)" colour="#00ff00">
    <block type="math_number"></block>
    <block type="math_arithmetic"></block>
  </category>
  <category name="Text (文字)" colour="#ffff00">
    <block type="text"></block>
    <block type="text_print"></block>
  </category>
  <category name="Variables (変数)" custom="VARIABLE" colour="#ff6600"></category>
  <category name="Functions (関数)" custom="PROCEDURE" colour="#3399ff"></category>
</xml>

<script>
  // Blocklyのテーマ定義（ネオン風）
  const neonTheme = Blockly.Theme.defineTheme('neon', {
    base: Blockly.Themes.Classic,
    componentStyles: {
      workspaceBackgroundColour: '#121212',
      toolboxBackgroundColour: '#1f1f1f',
      flyoutBackgroundColour: '#181818',
      flyoutOpacity: 0.9,
      scrollbarColour: '#0ff',
      insertionMarkerColour: '#ff0',
      insertionMarkerOpacity: 0.6,
      markerColour: '#f0f',
      cursorColour: '#0f0'
    },
    fontStyle: {
      family: 'Orbitron',
      weight: '500',
      size: 14
    }
  });

  const workspace = Blockly.inject('blocklyDiv', {
    toolbox: document.getElementById('toolbox'),
    theme: neonTheme,
    scrollbars: true
  });

  // カッコ付き日本語ラベル
  Blockly.Msg.CONTROLS_IF_MSG_IF = "if (もし)";
  Blockly.Msg.CONTROLS_REPEAT_TITLE = "repeat (くりかえし) %1 回";
  Blockly.Msg.TEXT_PRINT_TITLE = "print (表示) %1";
  Blockly.Msg.LOGIC_COMPARE_TOOLTIP_EQ = "equal (等しい)";
  Blockly.Msg.CONTROLS_WHILEUNTIL_TITLE_WHILE = "while (〜の間)";
  Blockly.Msg.VARIABLES_DEFAULT_NAME = "item (項目)";

  function showCode() {
    const code = Blockly.JavaScript.workspaceToCode(workspace);
    document.getElementById('codeArea').textContent = code;
  }

  function runCode() {
    try {
      const code = Blockly.JavaScript.workspaceToCode(workspace);
      document.getElementById('codeArea').textContent = code;
      new Function(code)();
    } catch (e) {
      alert("エラー:\n" + e);
    }
  }
</script>

</body>
</html>
