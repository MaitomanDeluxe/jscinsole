<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Scratch風 Blockly（ゲーミング）</title>
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #111;
      color: #fff;
      font-family: 'Arial Rounded MT Bold', 'Orbitron', sans-serif;
      overflow: hidden;
    }

    #blocklyDiv {
      height: 70%;
      width: 100%;
    }

    #buttons {
      background: #1b1b1b;
      padding: 10px;
      border-top: 2px solid #444;
    }

    button {
      background: #0f0f0f;
      color: #0ff;
      border: 1px solid #0ff;
      padding: 8px 14px;
      border-radius: 10px;
      font-size: 16px;
      margin-right: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button:hover {
      background: #0ff;
      color: #000;
    }

    #codeArea {
      background: #1a1a1a;
      color: #0f0;
      font-family: monospace;
      height: 20%;
      overflow: auto;
      padding: 10px;
      border-top: 2px solid #333;
    }

    /* Scratch風に見せる */
    .blocklySvg {
      background: #111 !important;
    }

    .blocklyBlockBackground {
      rx: 8;  /* 角を丸くする */
      fill: #1a1a1a !important; /* ブロックの背景色をダークグレーに */
      stroke-width: 3px; /* 縁取りを太くする */
      /* 各ブロックのテーマカラーで光るエフェクト */
      filter: drop-shadow(0 0 6px var(--blockly-block-color-primary));
      transition: filter 0.2s ease-in-out;
    }

    .blocklyBlockBackground:hover {
      filter: drop-shadow(0 0 12px var(--blockly-block-color-primary)); /* ホバーでさらに強く光る */
    }

    /* ブロック内の文字色を白に */
    .blocklyText {
      fill: #fff !important;
    }
  </style>
</head>
<body>

<div id="blocklyDiv"></div>

<div id="buttons">
  <button onclick="runCode()">Run</button>
  <button onclick="showCode()">Show JS</button>
</div>

<pre id="codeArea">// JavaScript code appears here</pre>

<xml id="toolbox" style="display: none">
  <category name="Logic (論理)" colour="#00ffff">
    <block type="controls_if"></block>
    <block type="logic_compare"></block>
    <block type="logic_operation"></block>
  </category>
  <category name="Loops (くりかえし)" colour="#ff66ff">
    <block type="controls_repeat_ext">
      <value name="TIMES"><shadow type="math_number"><field name="NUM">3</field></shadow></value>
    </block>
    <block type="controls_whileUntil"></block>
  </category>
  <category name="Math (数学)" colour="#66ff66">
    <block type="math_number"></block>
    <block type="math_arithmetic"></block>
    <block type="math_modulo"></block>
  </category>
  <category name="Text (文字)" colour="#ffff66">
    <block type="text"></block>
    <block type="text_print"></block>
    <block type="text_length"></block>
  </category>
  <category name="Variables (変数)" custom="VARIABLE" colour="#ff9966"></category>
  <category name="Functions (関数)" custom="PROCEDURE" colour="#6699ff"></category>
</xml>

<script>
  // カスタムScratch風テーマ（角丸、配色、太字）
  const scratchTheme = Blockly.Theme.defineTheme('scratch', {
    base: Blockly.Themes.Classic,
    blockStyles: {
      logic_blocks: {
        colourPrimary: '#00ffff',
        hat: 'cap'
      },
      loop_blocks: {
        colourPrimary: '#ff66ff'
      },
      math_blocks: {
        colourPrimary: '#66ff66'
      },
      text_blocks: {
        colourPrimary: '#ffff66'
      },
      variable_blocks: {
        colourPrimary: '#ff9966'
      },
      procedure_blocks: {
        colourPrimary: '#6699ff'
      }
    },
    fontStyle: {
      family: '"Arial Rounded MT Bold", Orbitron, sans-serif',
      weight: 'bold',
      size: 14,
      color: '#fff' // フォント色を白に設定
    },
    componentStyles: {
      workspaceBackgroundColour: '#111',
      toolboxBackgroundColour: '#1b1b1b',
      flyoutBackgroundColour: '#222',
      scrollbarColour: '#0ff', /* 鮮やかなシアン */
      insertionMarkerColour: '#ff0', /* 鮮やかなイエロー */
      cursorColour: '#f0f' /* 鮮やかなマゼンタ */
    }
  });

  const workspace = Blockly.inject('blocklyDiv', {
    toolbox: document.getElementById('toolbox'),
    theme: scratchTheme,
    scrollbars: true
  });

  // 日本語カッコつき表記
  Blockly.Msg.CONTROLS_IF_MSG_IF = "if (もし)";
  Blockly.Msg.CONTROLS_REPEAT_TITLE = "repeat (くりかえし) %1 回";
  Blockly.Msg.TEXT_PRINT_TITLE = "print (表示) %1";
  Blockly.Msg.LOGIC_COMPARE_TOOLTIP_EQ = "equal (等しい)";
  Blockly.Msg.CONTROLS_WHILEUNTIL_TITLE_WHILE = "while (〜の間)";
  Blockly.Msg.VARIABLES_DEFAULT_NAME = "item (項目)";

  function showCode() {
    const code = Blockly.JavaScript.workspaceToCode(workspace);
    document.getElementById('codeArea').textContent = code;
  }

  function runCode() {
    try {
      const code = Blockly.JavaScript.workspaceToCode(workspace);
      document.getElementById('codeArea').textContent = code;
      new Function(code)();
    } catch (e) {
      alert("エラー:\n" + e);
    }
  }
</script>

</body>
</html>
